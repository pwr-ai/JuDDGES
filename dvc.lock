schema: '2.0'
stages:
  build_fine_tuning_dataset:
    cmd: PYTHONPATH=. python scripts/sft/build_fine_tuning_dataset.py --dataset-dir
      data/datasets/pl/raw --repo-id JuDDGES/pl-court-instruct
    deps:
    - path: data/datasets/pl/raw
      hash: md5
      md5: 5dd44be2eea852bcce3d0918ff8b97da.dir
      size: 10234880729
      nfiles: 17
    - path: scripts/sft/build_fine_tuning_dataset.py
      hash: md5
      md5: f07a9d106853e74be4d0e4807b33ff3d
      size: 5393
  evaluate_zero_shot:
    cmd: PYTHONPATH=. python scripts/sft/evaluate_zero_shot.py --output-file data/results/pl/zero_shot/results_llama_3_8B.json
      --metrics-file data/results/pl/zero_shot/metrics_llama_3_8B.json
    deps:
    - path: scripts/sft/evaluate_zero_shot.py
      hash: md5
      md5: 1b5fd40e348f17bd2fe78e98244c4d6c
      size: 3826
    outs:
    - path: data/results/pl/zero_shot/metrics_llama_3_8B.json
      hash: md5
      md5: 95ac287e74bc109f224b95b12e5b17f4
      size: 170
    - path: data/results/pl/zero_shot/results_llama_3_8B.json
      hash: md5
      md5: 93f78708a597fad33b3da43e505b9707
      size: 957343
  evaluate_zero_shot@config0:
    cmd: PYTHONPATH=. python scripts/sft/evaluate_zero_shot.py --llm meta-llama/Meta-Llama-3-8B-Instruct
      --output-file data/results/pl_court_instruct/zero_shot/results_meta_llama_3_8B_instruct.json
      --metrics-file data/results/pl_court_instruct/zero_shot/metrics_meta_llama_3_8B_instruct.json
    deps:
    - path: scripts/sft/evaluate_zero_shot.py
      hash: md5
      md5: 26555545a062ce43602a8ac11280bbde
      size: 2714
    outs:
    - path: data/results/pl_court_instruct/zero_shot/metrics_meta_llama_3_8B_instruct.json
      hash: md5
      md5: fb665645d904d37e14a931e38fef9915
      size: 188
    - path: data/results/pl_court_instruct/zero_shot/results_meta_llama_3_8B_instruct.json
      hash: md5
      md5: 93f78708a597fad33b3da43e505b9707
      size: 957343
  fine_tune_sft@Mistral-7B-Instruct-v0.2:
    cmd: PYTHONPATH=. python scripts/sft/fine_tune_llm.py model=Mistral-7B-Instruct-v0.2
    deps:
    - path: configs/fine_tuning.yaml
      hash: md5
      md5: 9cd6fd320530e1c8ded7d9c369b8a082
      size: 440
    - path: configs/model/Mistral-7B-Instruct-v0.2.yaml
      hash: md5
      md5: 68461d0ab4970d1083a2d8fe191f5cd1
      size: 141
    - path: scripts/sft/fine_tune_llm.py
      hash: md5
      md5: d0c843f9066296b6654bbb0b81652da2
      size: 7012
    outs:
    - path: data/experiments/fine-tune/Mistral-7B-Instruct-v0.2/pl-court-instruct
      hash: md5
      md5: 4962aefc4af2bf7f96c4ba1cdb2a9918.dir
      size: 387238698
      nfiles: 44
  predict@Mistral-7B-Instruct-v0.2:
    cmd: PYTHONPATH=. python scripts/sft/predict.py model=Mistral-7B-Instruct-v0.2
    deps:
    - path: configs/model/Mistral-7B-Instruct-v0.2.yaml
      hash: md5
      md5: 68461d0ab4970d1083a2d8fe191f5cd1
      size: 141
    - path: configs/predict.yaml
      hash: md5
      md5: e6b047cf62e612a32381d6221eb99b4e
      size: 416
    - path: scripts/sft/predict.py
      hash: md5
      md5: 69e4844a715c9c5c75e1127a06472ad4
      size: 3148
    outs:
    - path: data/experiments/predict/pl-court-instruct/outputs_Mistral-7B-Instruct-v0.2.json
      hash: md5
      md5: 3d27738cbbc4c7bde92584d2d44a329d
      size: 2209577
  predict@Meta-Llama-3-8B-Instruct:
    cmd: PYTHONPATH=. python scripts/sft/predict.py model=Meta-Llama-3-8B-Instruct
    deps:
    - path: configs/model/Meta-Llama-3-8B-Instruct.yaml
      hash: md5
      md5: eb67ce09d1c076f42ac161c36501a73e
      size: 141
    - path: configs/predict.yaml
      hash: md5
      md5: e6b047cf62e612a32381d6221eb99b4e
      size: 416
    - path: scripts/sft/predict.py
      hash: md5
      md5: 69e4844a715c9c5c75e1127a06472ad4
      size: 3148
    outs:
    - path: data/experiments/predict/pl-court-instruct/outputs_Meta-Llama-3-8B-Instruct.json
      hash: md5
      md5: 1c5fad46651be58f5016b841745a6270
      size: 2256384
  predict@Mistral-7B-Instruct-v0.2-fine-tuned:
    cmd: PYTHONPATH=. python scripts/sft/predict.py model=Mistral-7B-Instruct-v0.2-fine-tuned
    deps:
    - path: configs/model/Mistral-7B-Instruct-v0.2-fine-tuned.yaml
      hash: md5
      md5: e9cdbe31c62745a86d3a0d1262bd95f6
      size: 222
    - path: configs/predict.yaml
      hash: md5
      md5: e6b047cf62e612a32381d6221eb99b4e
      size: 416
    - path: scripts/sft/predict.py
      hash: md5
      md5: 69e4844a715c9c5c75e1127a06472ad4
      size: 3148
    outs:
    - path: 
        data/experiments/predict/pl-court-instruct/outputs_Mistral-7B-Instruct-v0.2-fine-tuned.json
      hash: md5
      md5: adf03a2b51a7a9cd4431c884a89f6497
      size: 1843278
  evaluate@Mistral-7B-Instruct-v0.2:
    cmd: PYTHONPATH=. python scripts/sft/evaluate.py  --output-file data/experiments/predict/pl-court-instruct/outputs_Mistral-7B-Instruct-v0.2.json
    deps:
    - path: data/experiments/predict/pl-court-instruct/outputs_Mistral-7B-Instruct-v0.2.json
      hash: md5
      md5: 3d27738cbbc4c7bde92584d2d44a329d
      size: 2209577
    - path: scripts/sft/evaluate.py
      hash: md5
      md5: 5ee442a9a3525af7596bf24c3d724a1d
      size: 570
    outs:
    - path: data/experiments/predict/pl-court-instruct/metrics_Mistral-7B-Instruct-v0.2.json
      hash: md5
      md5: a3116f4a1f47ca64b4926d35d69855bb
      size: 308
  evaluate@Mistral-7B-Instruct-v0.2-fine-tuned:
    cmd: PYTHONPATH=. python scripts/sft/evaluate.py  --output-file 
      data/experiments/predict/pl-court-instruct/outputs_Mistral-7B-Instruct-v0.2-fine-tuned.json
    deps:
    - path: 
        data/experiments/predict/pl-court-instruct/outputs_Mistral-7B-Instruct-v0.2-fine-tuned.json
      hash: md5
      md5: adf03a2b51a7a9cd4431c884a89f6497
      size: 1843278
    - path: scripts/sft/evaluate.py
      hash: md5
      md5: 5ee442a9a3525af7596bf24c3d724a1d
      size: 570
    outs:
    - path: 
        data/experiments/predict/pl-court-instruct/metrics_Mistral-7B-Instruct-v0.2-fine-tuned.json
      hash: md5
      md5: 32c8a6e388f68e1c10e7b8fd5852e6d6
      size: 306
  evaluate@Meta-Llama-3-8B-Instruct:
    cmd: PYTHONPATH=. python scripts/sft/evaluate.py  --output-file data/experiments/predict/pl-court-instruct/outputs_Meta-Llama-3-8B-Instruct.json
    deps:
    - path: data/experiments/predict/pl-court-instruct/outputs_Meta-Llama-3-8B-Instruct.json
      hash: md5
      md5: 1c5fad46651be58f5016b841745a6270
      size: 2256384
    - path: scripts/sft/evaluate.py
      hash: md5
      md5: 5ee442a9a3525af7596bf24c3d724a1d
      size: 570
    outs:
    - path: data/experiments/predict/pl-court-instruct/metrics_Meta-Llama-3-8B-Instruct.json
      hash: md5
      md5: abddc02961f30ee6f02b50a264ae505f
      size: 306
  sft@Mistral-7B-Instruct-v0.2:
    cmd: PYTHONPATH=. python scripts/sft/fine_tune_llm.py model=Mistral-7B-Instruct-v0.2
    deps:
    - path: configs/fine_tuning.yaml
      hash: md5
      md5: 9cd6fd320530e1c8ded7d9c369b8a082
      size: 440
    - path: configs/model/Mistral-7B-Instruct-v0.2.yaml
      hash: md5
      md5: 68461d0ab4970d1083a2d8fe191f5cd1
      size: 141
    - path: scripts/sft/fine_tune_llm.py
      hash: md5
      md5: d0c843f9066296b6654bbb0b81652da2
      size: 7012
    outs:
    - path: data/experiments/fine-tune/Mistral-7B-Instruct-v0.2/pl-court-instruct
      hash: md5
      md5: 4962aefc4af2bf7f96c4ba1cdb2a9918.dir
      size: 387238698
      nfiles: 44
  embed@mmlw-roberta-large:
    cmd: PYTHONPATH=. python scripts/embed/embed_text.py embedding_model=mmlw-roberta-large
    deps:
    - path: configs/embedding.yaml
      hash: md5
      md5: 8eb43bec3f5fe10d5c1c5cfefc5d6fe5
      size: 379
    - path: configs/embedding_model/mmlw-roberta-large.yaml
      hash: md5
      md5: 22f36cfd196c0fdc3cfd8a036d52b606
      size: 52
    - path: data/datasets/pl/raw
      hash: md5
      md5: 5dd44be2eea852bcce3d0918ff8b97da.dir
      size: 10234880729
      nfiles: 17
    - path: scripts/embed/embed_text.py
      hash: md5
      md5: f3288be3419e01ebc2be904d52cbaab0
      size: 3451
    outs:
    - path: data/embeddings/pl-court-raw/mmlw-roberta-large/all_embeddings
      hash: md5
      md5: 1a086db46b90b0f3c4c66c3ecefe8adb.dir
      size: 24415235644
      nfiles: 53
  predict@Unsloth-Llama-3-8B-Instruct-fine-tuned:
    cmd: PYTHONPATH=. python scripts/sft/predict.py model=Unsloth-Llama-3-8B-Instruct-fine-tuned
    deps:
    - path: configs/model/Unsloth-Llama-3-8B-Instruct-fine-tuned.yaml
      hash: md5
      md5: c9fab7cd7a4b0159d13ba61e3c516c0a
      size: 244
    - path: configs/predict.yaml
      hash: md5
      md5: e6b047cf62e612a32381d6221eb99b4e
      size: 416
    - path: scripts/sft/predict.py
      hash: md5
      md5: 69e4844a715c9c5c75e1127a06472ad4
      size: 3148
    outs:
    - path: 
        data/experiments/predict/pl-court-instruct/outputs_Unsloth-Llama-3-8B-Instruct-fine-tuned.json
      hash: md5
      md5: 9199da7e04fb35cc1ce2bbe9dd5cd274
      size: 1891254
  evaluate@Unsloth-Llama-3-8B-Instruct-fine-tuned:
    cmd: PYTHONPATH=. python scripts/sft/evaluate.py  --output-file 
      data/experiments/predict/pl-court-instruct/outputs_Unsloth-Llama-3-8B-Instruct-fine-tuned.json
    deps:
    - path: 
        data/experiments/predict/pl-court-instruct/outputs_Unsloth-Llama-3-8B-Instruct-fine-tuned.json
      hash: md5
      md5: 9199da7e04fb35cc1ce2bbe9dd5cd274
      size: 1891254
    - path: scripts/sft/evaluate.py
      hash: md5
      md5: 5ee442a9a3525af7596bf24c3d724a1d
      size: 570
    outs:
    - path: 
        data/experiments/predict/pl-court-instruct/metrics_Unsloth-Llama-3-8B-Instruct-fine-tuned.json
      hash: md5
      md5: 6a0eb30a14687342bc86ae80253cd60c
      size: 306
  sft_unsloth@Unsloth-Llama-3-8B-Instruct:
    cmd: PYTHONPATH=. python scripts/sft/fine_tune_unsloth.py model=Unsloth-Llama-3-8B-Instruct
    deps:
    - path: configs/fine_tuning.yaml
      hash: md5
      md5: 9cd6fd320530e1c8ded7d9c369b8a082
      size: 440
    - path: configs/model/Unsloth-Llama-3-8B-Instruct.yaml
      hash: md5
      md5: e97bb2e6bf39f75edea7714d6ba58b77
      size: 160
    - path: scripts/sft/fine_tune_unsloth.py
      hash: md5
      md5: c8a06fdcb01188a621b5fc9cc579ea56
      size: 6904
    outs:
    - path: data/experiments/fine-tune/Unsloth-Llama-3-8B-Instruct/pl-court-instruct
      hash: md5
      md5: 3e19503b79a8369ce4de2b67129e0f7c.dir
      size: 7068367431
      nfiles: 297
  predict@Unsloth-Mistral-7B-Instruct-v0.3:
    cmd: PYTHONPATH=. python scripts/sft/predict.py model=Unsloth-Mistral-7B-Instruct-v0.3
    deps:
    - path: configs/model/Unsloth-Mistral-7B-Instruct-v0.3.yaml
      hash: md5
      md5: 71dbbb0a8a2454c7c0210e2d1acd859d
      size: 167
    - path: configs/predict.yaml
      hash: md5
      md5: e6b047cf62e612a32381d6221eb99b4e
      size: 416
    - path: scripts/sft/predict.py
      hash: md5
      md5: 69e4844a715c9c5c75e1127a06472ad4
      size: 3148
    outs:
    - path: 
        data/experiments/predict/pl-court-instruct/outputs_Unsloth-Mistral-7B-Instruct-v0.3.json
      hash: md5
      md5: c2e03f3fbd29c744023bdac7e1007265
      size: 2007040
  summarize_metrics@data/experiments/predict/pl-court-instruct:
    cmd: PYTHONPATH=. python scripts/sft/summarize_metrics.py  --root-dir data/experiments/predict/pl-court-instruct
    deps:
    - path: scripts/sft/summarize_metrics.py
      hash: md5
      md5: 38d14e02488c2bc1876651d444af94b1
      size: 729
    outs:
    - path: data/experiments/predict/pl-court-instruct/metrics_summary.md
      hash: md5
      md5: a72452f53099f61de9d653af1a596a3a
      size: 1119
  evaluate@Unsloth-Mistral-7B-Instruct-v0.3:
    cmd: PYTHONPATH=. python scripts/sft/evaluate.py  --output-file 
      data/experiments/predict/pl-court-instruct/outputs_Unsloth-Mistral-7B-Instruct-v0.3.json
    deps:
    - path: 
        data/experiments/predict/pl-court-instruct/outputs_Unsloth-Mistral-7B-Instruct-v0.3.json
      hash: md5
      md5: c2e03f3fbd29c744023bdac7e1007265
      size: 2007040
    - path: scripts/sft/evaluate.py
      hash: md5
      md5: 5ee442a9a3525af7596bf24c3d724a1d
      size: 570
    outs:
    - path: 
        data/experiments/predict/pl-court-instruct/metrics_Unsloth-Mistral-7B-Instruct-v0.3.json
      hash: md5
      md5: 091b8888275600052dd2dcdd36a55588
      size: 305
  aggregate_embeddings@mmlw-roberta-large:
    cmd: PYTHONPATH=. python scripts/embed/aggregate_embeddings.py  --embeddings-dir
      data/embeddings/pl-court-raw/mmlw-roberta-large/all_embeddings
    deps:
    - path: data/embeddings/pl-court-raw/mmlw-roberta-large/all_embeddings
      hash: md5
      md5: 1a086db46b90b0f3c4c66c3ecefe8adb.dir
      size: 24415235644
      nfiles: 53
    - path: scripts/embed/aggregate_embeddings.py
      hash: md5
      md5: f27180b8a98089d51481ef1327d1fa01
      size: 1797
    outs:
    - path: data/embeddings/pl-court-raw/mmlw-roberta-large/agg_embeddings.pt
      hash: md5
      md5: c3eb5051fd96f9e1521dd425ed6d671a
      size: 1728016767
